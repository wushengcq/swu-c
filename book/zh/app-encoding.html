
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>字符编码 &mdash; akabook 3.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="akabook 3.0 documentation" href="../index.html" />
    <link rel="up" title="中文版：Linux C/C++编程一站式学习" href="index.html" />
    <link rel="next" title="GNU Free Documentation License Version 1.3, 3 November 2008" href="app-gfdl.html" />
    <link rel="prev" title="12. 链表、二叉树和哈希表" href="linkedlist.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="app-gfdl.html" title="GNU Free Documentation License Version 1.3, 3 November 2008"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="linkedlist.html" title="12. 链表、二叉树和哈希表"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">akabook 3.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">中文版：Linux C/C++编程一站式学习</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>字符编码<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="ascii">
<h2>ASCII码<a class="headerlink" href="#ascii" title="Permalink to this headline">¶</a></h2>
<p>ASCII码的取值范围是0~127，可以用7个bit表示。C语言规定 <code class="docutils literal"><span class="pre">char</span></code> 型占一个字节，如果存放ASCII码则只用到低7位，高位为0。以下是ASCII码表：</p>
<table border="1" class="docutils" id="id3">
<span id="app-encoding-asciitable"></span><caption><span class="caption-text">ASCII码表</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="4%" />
<col width="3%" />
<col width="4%" />
<col width="37%" />
<col width="4%" />
<col width="3%" />
<col width="4%" />
<col width="9%" />
<col width="4%" />
<col width="3%" />
<col width="4%" />
<col width="5%" />
<col width="4%" />
<col width="3%" />
<col width="4%" />
<col width="5%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Dec</th>
<th class="head">Hx</th>
<th class="head">Oct</th>
<th class="head">Char</th>
<th class="head">Dec</th>
<th class="head">Hx</th>
<th class="head">Oct</th>
<th class="head">Char</th>
<th class="head">Dec</th>
<th class="head">Hx</th>
<th class="head">Oct</th>
<th class="head">Char</th>
<th class="head">Dec</th>
<th class="head">Hx</th>
<th class="head">Oct</th>
<th class="head">Char</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>0</td>
<td>0</td>
<td>NUL (null)</td>
<td>32</td>
<td>20</td>
<td>40</td>
<td>(blank)</td>
<td>64</td>
<td>40</td>
<td>100</td>
<td>&#64;</td>
<td>96</td>
<td>60</td>
<td>140</td>
<td>`</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>1</td>
<td>1</td>
<td>SOH (start of heading)</td>
<td>33</td>
<td>21</td>
<td>41</td>
<td>!</td>
<td>65</td>
<td>41</td>
<td>101</td>
<td>A</td>
<td>97</td>
<td>61</td>
<td>141</td>
<td>a</td>
</tr>
<tr class="row-even"><td>2</td>
<td>2</td>
<td>2</td>
<td>STX (start of text)</td>
<td>34</td>
<td>22</td>
<td>42</td>
<td>&#8220;</td>
<td>66</td>
<td>42</td>
<td>102</td>
<td>B</td>
<td>98</td>
<td>62</td>
<td>142</td>
<td>b</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>3</td>
<td>3</td>
<td>ETX (end of text)</td>
<td>35</td>
<td>23</td>
<td>43</td>
<td>#</td>
<td>67</td>
<td>43</td>
<td>103</td>
<td>C</td>
<td>99</td>
<td>63</td>
<td>143</td>
<td>c</td>
</tr>
<tr class="row-even"><td>4</td>
<td>4</td>
<td>4</td>
<td>EOT (end of transmission)</td>
<td>36</td>
<td>24</td>
<td>44</td>
<td>$</td>
<td>68</td>
<td>44</td>
<td>104</td>
<td>D</td>
<td>100</td>
<td>64</td>
<td>144</td>
<td>d</td>
</tr>
<tr class="row-odd"><td>5</td>
<td>5</td>
<td>5</td>
<td>ENQ (enquiry)</td>
<td>37</td>
<td>25</td>
<td>45</td>
<td>%</td>
<td>69</td>
<td>45</td>
<td>105</td>
<td>E</td>
<td>101</td>
<td>65</td>
<td>145</td>
<td>e</td>
</tr>
<tr class="row-even"><td>6</td>
<td>6</td>
<td>6</td>
<td>ACK (acknowledge)</td>
<td>38</td>
<td>26</td>
<td>46</td>
<td>&amp;</td>
<td>70</td>
<td>46</td>
<td>106</td>
<td>F</td>
<td>102</td>
<td>66</td>
<td>146</td>
<td>f</td>
</tr>
<tr class="row-odd"><td>7</td>
<td>7</td>
<td>7</td>
<td>BEL (bell)</td>
<td>39</td>
<td>27</td>
<td>47</td>
<td>&#8216;</td>
<td>71</td>
<td>47</td>
<td>107</td>
<td>G</td>
<td>103</td>
<td>67</td>
<td>147</td>
<td>g</td>
</tr>
<tr class="row-even"><td>8</td>
<td>8</td>
<td>10</td>
<td>BS  (backspace)</td>
<td>40</td>
<td>28</td>
<td>50</td>
<td>(</td>
<td>72</td>
<td>48</td>
<td>110</td>
<td>H</td>
<td>104</td>
<td>68</td>
<td>150</td>
<td>h</td>
</tr>
<tr class="row-odd"><td>9</td>
<td>9</td>
<td>11</td>
<td>TAB (horizontal tab)</td>
<td>41</td>
<td>29</td>
<td>51</td>
<td>)</td>
<td>73</td>
<td>49</td>
<td>111</td>
<td>I</td>
<td>105</td>
<td>69</td>
<td>151</td>
<td>i</td>
</tr>
<tr class="row-even"><td>10</td>
<td>a</td>
<td>12</td>
<td>LF  (NL line feed, new line)</td>
<td>42</td>
<td>2a</td>
<td>52</td>
<td>*</td>
<td>74</td>
<td>4a</td>
<td>112</td>
<td>J</td>
<td>106</td>
<td>6a</td>
<td>152</td>
<td>j</td>
</tr>
<tr class="row-odd"><td>11</td>
<td>b</td>
<td>13</td>
<td>VT  (vertical tab)</td>
<td>43</td>
<td>2b</td>
<td>53</td>
<td>+</td>
<td>75</td>
<td>4b</td>
<td>113</td>
<td>K</td>
<td>107</td>
<td>6b</td>
<td>153</td>
<td>k</td>
</tr>
<tr class="row-even"><td>12</td>
<td>c</td>
<td>14</td>
<td>FF  (NP form feed, new page)</td>
<td>44</td>
<td>2c</td>
<td>54</td>
<td>,</td>
<td>76</td>
<td>4c</td>
<td>114</td>
<td>L</td>
<td>108</td>
<td>6c</td>
<td>154</td>
<td>l</td>
</tr>
<tr class="row-odd"><td>13</td>
<td>d</td>
<td>15</td>
<td>CR  (carriage return)</td>
<td>45</td>
<td>2d</td>
<td>55</td>
<td>-</td>
<td>77</td>
<td>4d</td>
<td>115</td>
<td>M</td>
<td>109</td>
<td>6d</td>
<td>155</td>
<td>m</td>
</tr>
<tr class="row-even"><td>14</td>
<td>e</td>
<td>16</td>
<td>SO  (shift out)</td>
<td>46</td>
<td>2e</td>
<td>56</td>
<td>.</td>
<td>78</td>
<td>4e</td>
<td>116</td>
<td>N</td>
<td>110</td>
<td>6e</td>
<td>156</td>
<td>n</td>
</tr>
<tr class="row-odd"><td>15</td>
<td>f</td>
<td>17</td>
<td>SI  (shift in)</td>
<td>47</td>
<td>2f</td>
<td>57</td>
<td>/</td>
<td>79</td>
<td>4f</td>
<td>117</td>
<td>O</td>
<td>111</td>
<td>6f</td>
<td>157</td>
<td>o</td>
</tr>
<tr class="row-even"><td>16</td>
<td>10</td>
<td>20</td>
<td>DLE (data link escape)</td>
<td>48</td>
<td>30</td>
<td>60</td>
<td>0</td>
<td>80</td>
<td>50</td>
<td>120</td>
<td>P</td>
<td>112</td>
<td>70</td>
<td>160</td>
<td>p</td>
</tr>
<tr class="row-odd"><td>17</td>
<td>11</td>
<td>21</td>
<td>DC1 (device control 1)</td>
<td>49</td>
<td>31</td>
<td>61</td>
<td>1</td>
<td>81</td>
<td>51</td>
<td>121</td>
<td>Q</td>
<td>113</td>
<td>71</td>
<td>161</td>
<td>q</td>
</tr>
<tr class="row-even"><td>18</td>
<td>12</td>
<td>22</td>
<td>DC2 (device control 2)</td>
<td>50</td>
<td>32</td>
<td>62</td>
<td>2</td>
<td>82</td>
<td>52</td>
<td>122</td>
<td>R</td>
<td>114</td>
<td>72</td>
<td>162</td>
<td>r</td>
</tr>
<tr class="row-odd"><td>19</td>
<td>13</td>
<td>23</td>
<td>DC3 (device control 3)</td>
<td>51</td>
<td>33</td>
<td>63</td>
<td>3</td>
<td>83</td>
<td>53</td>
<td>123</td>
<td>S</td>
<td>115</td>
<td>73</td>
<td>163</td>
<td>s</td>
</tr>
<tr class="row-even"><td>20</td>
<td>14</td>
<td>24</td>
<td>DC4 (device control 4)</td>
<td>52</td>
<td>34</td>
<td>64</td>
<td>4</td>
<td>84</td>
<td>54</td>
<td>124</td>
<td>T</td>
<td>116</td>
<td>74</td>
<td>164</td>
<td>t</td>
</tr>
<tr class="row-odd"><td>21</td>
<td>15</td>
<td>25</td>
<td>NAK (negative acknowledge)</td>
<td>53</td>
<td>35</td>
<td>65</td>
<td>5</td>
<td>85</td>
<td>55</td>
<td>125</td>
<td>U</td>
<td>117</td>
<td>75</td>
<td>165</td>
<td>u</td>
</tr>
<tr class="row-even"><td>22</td>
<td>16</td>
<td>26</td>
<td>SYN (synchronous idle)</td>
<td>54</td>
<td>36</td>
<td>66</td>
<td>6</td>
<td>86</td>
<td>56</td>
<td>126</td>
<td>V</td>
<td>118</td>
<td>76</td>
<td>166</td>
<td>v</td>
</tr>
<tr class="row-odd"><td>23</td>
<td>17</td>
<td>27</td>
<td>ETB (end of trans. block)</td>
<td>55</td>
<td>37</td>
<td>67</td>
<td>7</td>
<td>87</td>
<td>57</td>
<td>127</td>
<td>W</td>
<td>119</td>
<td>77</td>
<td>167</td>
<td>w</td>
</tr>
<tr class="row-even"><td>24</td>
<td>18</td>
<td>30</td>
<td>CAN (cancel)</td>
<td>56</td>
<td>38</td>
<td>70</td>
<td>8</td>
<td>88</td>
<td>58</td>
<td>130</td>
<td>X</td>
<td>120</td>
<td>78</td>
<td>170</td>
<td>x</td>
</tr>
<tr class="row-odd"><td>25</td>
<td>19</td>
<td>31</td>
<td>EM  (end of medium)</td>
<td>57</td>
<td>39</td>
<td>71</td>
<td>9</td>
<td>89</td>
<td>59</td>
<td>131</td>
<td>Y</td>
<td>121</td>
<td>79</td>
<td>171</td>
<td>y</td>
</tr>
<tr class="row-even"><td>26</td>
<td>1a</td>
<td>32</td>
<td>SUB (substitute)</td>
<td>58</td>
<td>3a</td>
<td>72</td>
<td>:</td>
<td>90</td>
<td>5a</td>
<td>132</td>
<td>Z</td>
<td>122</td>
<td>7a</td>
<td>172</td>
<td>z</td>
</tr>
<tr class="row-odd"><td>27</td>
<td>1b</td>
<td>33</td>
<td>ESC (escape)</td>
<td>59</td>
<td>3b</td>
<td>73</td>
<td>;</td>
<td>91</td>
<td>5b</td>
<td>133</td>
<td>[</td>
<td>123</td>
<td>7b</td>
<td>173</td>
<td>{</td>
</tr>
<tr class="row-even"><td>28</td>
<td>1c</td>
<td>34</td>
<td>FS  (file separator)</td>
<td>60</td>
<td>3c</td>
<td>74</td>
<td>&lt;</td>
<td>92</td>
<td>5c</td>
<td>134</td>
<td>\</td>
<td>124</td>
<td>7c</td>
<td>174</td>
<td>|</td>
</tr>
<tr class="row-odd"><td>29</td>
<td>1d</td>
<td>35</td>
<td>GS  (group separator)</td>
<td>61</td>
<td>3d</td>
<td>75</td>
<td>=</td>
<td>93</td>
<td>5d</td>
<td>135</td>
<td>]</td>
<td>125</td>
<td>7d</td>
<td>175</td>
<td>}</td>
</tr>
<tr class="row-even"><td>30</td>
<td>1e</td>
<td>36</td>
<td>RS  (recored separator)</td>
<td>62</td>
<td>3e</td>
<td>76</td>
<td>&gt;</td>
<td>94</td>
<td>5e</td>
<td>136</td>
<td>^</td>
<td>126</td>
<td>7e</td>
<td>176</td>
<td>~</td>
</tr>
<tr class="row-odd"><td>31</td>
<td>1f</td>
<td>37</td>
<td>US  (unit separator)</td>
<td>63</td>
<td>3f</td>
<td>77</td>
<td>?</td>
<td>95</td>
<td>5f</td>
<td>137</td>
<td>_</td>
<td>127</td>
<td>7f</td>
<td>177</td>
<td>DEL</td>
</tr>
</tbody>
</table>
<p id="index-0">绝大多数计算机的一个字节是8位，取值范围是0~255，而ASCII码并没有规定编号为128~255的字符，为了能用一个字节表示更多的字符，各厂商制定了很多种ASCII码的扩展规范。注意，虽然通常把这些规范称为扩展ASCII码（Extended ASCII），但其实它们并不属于ASCII码标准。例如下面这种扩展ASCII码由IBM制定，在字符终端下被广泛采用，其中包含了很多表格边线字符用来画界面。</p>
<div class="figure" id="id4">
<img alt="../_images/app-encoding.extascii.png" src="../_images/app-encoding.extascii.png" />
<p class="caption"><span class="caption-text">IBM的扩展ASCII码表</span></p>
</div>
<p id="index-1">在图形界面下最广泛使用的扩展ASCII码是ISO-8859-1，也称为Latin-1，其中包含欧洲各国语言中最常用的非英文字母，但毕竟只扩展了128个字符，一些不常用的字母就没有包含进来。如下表所示。</p>
<table border="1" class="docutils" id="id5">
<caption><span class="caption-text">ISO-8859-1</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="13%" />
<col width="4%" />
<col width="13%" />
<col width="4%" />
<col width="13%" />
<col width="4%" />
<col width="13%" />
<col width="4%" />
<col width="13%" />
<col width="4%" />
<col width="13%" />
<col width="4%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>160</td>
<td>&nbsp;</td>
<td>176</td>
<td>°</td>
<td>192</td>
<td>À</td>
<td>208</td>
<td>Ð</td>
<td>224</td>
<td>à</td>
<td>240</td>
<td>ð</td>
</tr>
<tr class="row-even"><td>161</td>
<td>¡</td>
<td>177</td>
<td>±</td>
<td>193</td>
<td>Á</td>
<td>209</td>
<td>Ñ</td>
<td>225</td>
<td>á</td>
<td>241</td>
<td>ñ</td>
</tr>
<tr class="row-odd"><td>162</td>
<td>¢</td>
<td>178</td>
<td>²</td>
<td>194</td>
<td>Â</td>
<td>210</td>
<td>Ò</td>
<td>226</td>
<td>â</td>
<td>242</td>
<td>ò</td>
</tr>
<tr class="row-even"><td>163</td>
<td>£</td>
<td>179</td>
<td>³</td>
<td>195</td>
<td>Ã</td>
<td>211</td>
<td>Ó</td>
<td>227</td>
<td>ã</td>
<td>243</td>
<td>ó</td>
</tr>
<tr class="row-odd"><td>164</td>
<td>¤</td>
<td>180</td>
<td>´</td>
<td>196</td>
<td>Ä</td>
<td>212</td>
<td>Ô</td>
<td>228</td>
<td>ä</td>
<td>244</td>
<td>ô</td>
</tr>
<tr class="row-even"><td>165</td>
<td>¥</td>
<td>181</td>
<td>µ</td>
<td>197</td>
<td>Å</td>
<td>213</td>
<td>Õ</td>
<td>229</td>
<td>å</td>
<td>245</td>
<td>õ</td>
</tr>
<tr class="row-odd"><td>166</td>
<td>¦</td>
<td>182</td>
<td>¶</td>
<td>198</td>
<td>Æ</td>
<td>214</td>
<td>Ö</td>
<td>230</td>
<td>æ</td>
<td>246</td>
<td>ö</td>
</tr>
<tr class="row-even"><td>167</td>
<td>§</td>
<td>183</td>
<td>·</td>
<td>199</td>
<td>Ç</td>
<td>215</td>
<td>×</td>
<td>231</td>
<td>ç</td>
<td>247</td>
<td>÷</td>
</tr>
<tr class="row-odd"><td>168</td>
<td>¨</td>
<td>184</td>
<td>¸</td>
<td>200</td>
<td>È</td>
<td>216</td>
<td>Ø</td>
<td>232</td>
<td>è</td>
<td>248</td>
<td>ø</td>
</tr>
<tr class="row-even"><td>169</td>
<td>©</td>
<td>185</td>
<td>¹</td>
<td>201</td>
<td>É</td>
<td>217</td>
<td>Ù</td>
<td>233</td>
<td>é</td>
<td>249</td>
<td>ù</td>
</tr>
<tr class="row-odd"><td>170</td>
<td>ª</td>
<td>186</td>
<td>º</td>
<td>202</td>
<td>Ê</td>
<td>218</td>
<td>Ú</td>
<td>234</td>
<td>ê</td>
<td>250</td>
<td>ú</td>
</tr>
<tr class="row-even"><td>171</td>
<td>«</td>
<td>187</td>
<td>»</td>
<td>203</td>
<td>Ë</td>
<td>219</td>
<td>Û</td>
<td>235</td>
<td>ë</td>
<td>251</td>
<td>û</td>
</tr>
<tr class="row-odd"><td>172</td>
<td>¬</td>
<td>188</td>
<td>¼</td>
<td>204</td>
<td>Ì</td>
<td>220</td>
<td>Ü</td>
<td>236</td>
<td>ì</td>
<td>252</td>
<td>ü</td>
</tr>
<tr class="row-even"><td>173</td>
<td>­</td>
<td>189</td>
<td>½</td>
<td>205</td>
<td>Í</td>
<td>221</td>
<td>Ý</td>
<td>237</td>
<td>í</td>
<td>253</td>
<td>ý</td>
</tr>
<tr class="row-odd"><td>174</td>
<td>®</td>
<td>190</td>
<td>¾</td>
<td>206</td>
<td>Î</td>
<td>222</td>
<td>Þ</td>
<td>238</td>
<td>î</td>
<td>254</td>
<td>þ</td>
</tr>
<tr class="row-even"><td>175</td>
<td>¯</td>
<td>191</td>
<td>¿</td>
<td>207</td>
<td>Ï</td>
<td>223</td>
<td>ß</td>
<td>239</td>
<td>ï</td>
<td>255</td>
<td>ÿ</td>
</tr>
</tbody>
</table>
<p>编号128~159的是一些控制字符，在上表中没有列出。</p>
</div>
<div class="section" id="unicodeutf-8">
<h2>Unicode和UTF-8<a class="headerlink" href="#unicodeutf-8" title="Permalink to this headline">¶</a></h2>
<p id="index-2">为了在一套编码中涵盖全世界各国语言文字和专业领域符号（例如数学符号、乐谱符号），ISO制定了ISO 10646标准，也称为UCS（Universal Character Set）。UCS编码的长度是31位，可以表示2<sup>31</sup> 个字符。如果两个字符编码的高位相同，只有低16位不同，则它们属于同一个平面（Plane），所以一个平面由2<sup>16</sup> 个字符组成。目前绝大多数常用字符都位于第一个平面（编码范围是0x0000~0xFFFF），称为BMP（Basic Multilingual Plane）或Plane 0，为了向后兼容，其中编号为0~256的字符和ASCII码以及Latin-1相同。UCS编码通常用U-xxxxxxxx这种形式表示，而BMP的编码通常用U+xxxx这种形式表示，其中x是十六进制数字。在ISO制定UCS的同时，另一个厂商联合组织也在着手制定这样的编码，称为Unicode，后来两家联手制定统一的编码，但各自发布各自的标准文档，所以UCS编码和Unicode码是相同的。</p>
<p id="index-3">有了字符编码，另一个问题就是这样的编码在计算机中怎么表示。现在已经不可能用一个字节表示一个字符了，最直接的想法就是用四个字节表示一个字符，这种表示方法称为UCS-4或UTF-32，UTF是Unicode Transformation Format的缩写。这样表示显然比较浪费存储空间，如果表示BMP字符，4个字节中的两个高位字节都是0，如果表示ASCII或Latin-1字符，4个字节中的3个高位字节都是0，而我们常用的绝大多数字符都在BMP、ASCII或Latin-1字符集中。另一种比较节省存储空间的办法是用两个字节表示一个字符，称为UCS-2或UTF-16，这样只能表示BMP中的字符，但BMP中有一些控制字符用于扩展，可以用两个这样的控制字符表示其他平面的字符，称为Surrogate Pair。</p>
<p>无论是UTF-32还是UTF-16都有一个更严重的问题就是和C语言不兼容，在C语言中字节0表示字符串结尾，库函数 <code class="docutils literal"><span class="pre">strlen</span></code> 、 <code class="docutils literal"><span class="pre">strcpy</span></code> 等等都依赖于这一点，如果字符串用UTF-32或UTF-16存储，其中有很多字节0并不表示字符串结尾，那就乱套了。</p>
<p id="index-4">UNIX之父Ken Thompson提出的UTF-8编码很好地解决了这个问题，因此得到广泛应用。和UTF-16、UTF-32不同的是，UTF-8编码的长度不固定，每个字符用1~6个字节表示。UTF-8编码具有以下性质：</p>
<ul class="simple">
<li>编码为U+0000~U+007F的字符只占一个字节，就是0x00~0x7F，和ASCII码兼容。</li>
<li>编码大于U+007F的字符用2~6个字节表示，每个字节的最高位都是1，而所有ASCII码的最高位都是0，因此非ASCII码字符的UTF-8编码中不会出现ASCII码的字节（也不会出现字节0）。</li>
<li>在非ASCII码字符的多字节编码中，第一个字节的取值范围是0xC0~0xFD，根据第一个字节可以判断后面还有几个字节也属于当前字符的编码，后面每个字节的取值范围都是0x80~0xBF，详见下面的编码格式。</li>
<li>所有Unicode字符（共231个）都可以用UTF-8编码表示出来。</li>
<li>UTF-8编码最长6个字节，BMP字符的UTF-8编码最长三个字节。</li>
<li>0xFE和0xFF这两个字节在UTF-8编码中不会出现。</li>
</ul>
<p>具体来说，UTF-8编码有以下几种格式:</p>
<div class="highlight-python"><div class="highlight"><pre>U-00000000 – U-0000007F: 0xxxxxxx
U-00000080 – U-000007FF: 110xxxxx 10xxxxxx
U-00000800 – U-0000FFFF: 1110xxxx 10xxxxxx 10xxxxxx
U-00010000 – U-001FFFFF: 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
U-00200000 – U-03FFFFFF: 111110xx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx
U-04000000 – U-7FFFFFFF: 1111110x 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx
</pre></div>
</div>
<ul class="simple">
<li>ASCII码字符的UTF-8编码只有一个字节（就是ASCII码本身），最高位是0。</li>
<li>非ASCII码字符的第一个字节最高位是1，并且后面至少还要跟一个1，最高位后面跟几个1就表示后面还有几个字节也属于当前字符的编码，例如111110xx，最高位后面跟4个1，表示后面还有4个字节也属于当前字符的编码。</li>
<li>后面每个字节的最高两位都是10，而第一个字节的最高两位要么是0x，要么是11，因此可以和后面的字节区分开。这样的设计有利于误码同步，例如在网络传输过程中丢失了几个字节，很容易判断当前字符是不完整的，也很容易找到下一个字符应该从哪开始，顶多丢掉一两个字符就可以同步了，而不会导致后面的解码过程全部错乱。</li>
<li>上面的格式中标为x的位就是字符的Unicode码，最后一种6字节的格式中x位有31个，可以表示31位的Unicode码。UTF-8编码就像一列火车，第一个字节是车头，后面每个字节是车厢，其中承载的货物是Unicode码。UTF-8规定承载的Unicode码以大端表示，就是说第一个字节中的x位是Unicode码的高位，后面字节中的x位是Unicode码的低位。</li>
<li>UTF-8规定每个字符必须用尽可能少的字节来编码，换句话说，在符合编码格式的前提下，Unicode码从最高位开始的0位要尽可能少。</li>
</ul>
<p>举例来说，U+00A9（©字符）的二进制是10101001，编码成UTF-8是11000010 10101001（0xC2 0xA9），但不能编码成11100000 10000010 10101001。</p>
</div>
<div class="section" id="linux-cunicodeutf-8">
<h2>在Linux C编程中使用Unicode和UTF-8<a class="headerlink" href="#linux-cunicodeutf-8" title="Permalink to this headline">¶</a></h2>
<p>目前各种Linux发行版都支持UTF-8编码，在磁盘上保存一个含有非ASCII字符的文本文件，默认是以UTF-8编码的。当前系统的字符编码设置可以用 <strong class="command">locale</strong> 命令查看:</p>
<div class="highlight-python"><div class="highlight"><pre>$ locale
LANG=en_US.UTF-8
LANGUAGE=
LC_CTYPE=&quot;en_US.UTF-8&quot;
LC_NUMERIC=&quot;en_US.UTF-8&quot;
LC_TIME=&quot;en_US.UTF-8&quot;
LC_COLLATE=&quot;en_US.UTF-8&quot;
LC_MONETARY=&quot;en_US.UTF-8&quot;
LC_MESSAGES=&quot;en_US.UTF-8&quot;
LC_PAPER=&quot;en_US.UTF-8&quot;
LC_NAME=&quot;en_US.UTF-8&quot;
LC_ADDRESS=&quot;en_US.UTF-8&quot;
LC_TELEPHONE=&quot;en_US.UTF-8&quot;
LC_MEASUREMENT=&quot;en_US.UTF-8&quot;
LC_IDENTIFICATION=&quot;en_US.UTF-8&quot;
LC_ALL=
</pre></div>
</div>
<p id="index-5">Locale定义了语言、字符编码、日期时间格式、数字格式、货币格式等参数，详见 <em class="manpage">locale(1)</em> 、 <em class="manpage">locale(5)</em> 、 <em class="manpage">locale(7)</em> 。 <strong class="command">locale</strong> 命令列出的这些参数每一个都可以用环境变量单独设置，但通常这些参数的取值是一致的。在我的系统中只设置了环境变量 <code class="docutils literal"><span class="pre">LANG</span></code> ，其他参数没有设置，用 <strong class="command">locale</strong> 命令可以看到其他Locale参数也继承了环境变量 <code class="docutils literal"><span class="pre">LANG</span></code> 的值。</p>
<p>常用汉字都位于BMP中，所以一个汉字的UTF-8编码通常是3个字节。例如编辑一个C程序：</p>
<div class="highlight-c"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;你好</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>源文件是以UTF-8编码存储的:</p>
<div class="highlight-python"><div class="highlight"><pre>$ hexdump -C nihao.c
00000000  23 69 6e 63 6c 75 64 65  20 3c 73 74 64 69 6f 2e  |#include &lt;stdio.|
00000010  68 3e 0a 0a 69 6e 74 20  6d 61 69 6e 28 76 6f 69  |h&gt;..int main(voi|
00000020  64 29 0a 7b 0a 09 70 72  69 6e 74 66 28 22 e4 bd  |d).{..printf(&quot;..|
00000030  a0 e5 a5 bd 5c 6e 22 29  3b 0a 09 72 65 74 75 72  |....\n&quot;);..retur|
00000040  6e 20 30 3b 0a 7d 0a                              |n 0;.}.|
00000047
</pre></div>
</div>
<p id="index-6">其中 <code class="docutils literal"><span class="pre">e4</span> <span class="pre">bd</span> <span class="pre">a0</span></code> 这三个字节就是“你”的UTF-8编码， <code class="docutils literal"><span class="pre">e5</span> <span class="pre">a5</span> <span class="pre">bd</span></code> 这三个字节就是“好”的UTF-8编码。把它编译成目标文件，&#8221;你好n&#8221;这个字符串就成了这样一串字节： <code class="docutils literal"><span class="pre">e4</span> <span class="pre">bd</span> <span class="pre">a0</span> <span class="pre">e5</span> <span class="pre">a5</span> <span class="pre">bd</span> <span class="pre">0a</span> <span class="pre">00</span></code> ，转义序列由两个字节变成一个字节，字符串末尾添了一个字节0，而汉字仍然占3个字节，在C标准中多字节编码的字符称为Multibyte Character。运行这个程序会把这一串字节输出到当前终端设备，如果当前终端能够识别UTF-8编码（比如图形界面的终端窗口）就能打印出汉字，如果不能识别UTF-8编码（比如一般的字符终端）就打印不出汉字。也就是说，在这个程序中识别汉字的工作既不是由C编译器做的也不是由 <code class="docutils literal"><span class="pre">printf</span></code> 函数做的，C编译器原封不动地把源文件中的UTF-8编码复制到目标文件中， <code class="docutils literal"><span class="pre">printf</span></code> 函数再把这一串字节当作以Null结尾的字符串原封不动地输出到终端设备，识别汉字的工作是由终端设备做的。</p>
<p id="index-7">仅有这种程度的汉字支持是不够的，有时候我们需要在C程序中操作字符串里的字符，比如求字符串&#8221;你好n&#8221;中有几个汉字或字符，用 <code class="docutils literal"><span class="pre">strlen</span></code> 就不灵了，因为 <code class="docutils literal"><span class="pre">strlen</span></code> 求的是字节数而不是字符数。为了在程序中操作Unicode字符，C标准定义了宽字符（Wide Character）类型 <code class="docutils literal"><span class="pre">wchar_t</span></code> （使用这个类型名需包含头文件 <code class="file docutils literal"><span class="pre">wchar.h</span></code> ）。在字符常量或字符串字面值前面加一个 <code class="docutils literal"><span class="pre">L</span></code> 就表示宽字符常量或宽字符串，例如定义 <code class="docutils literal"><span class="pre">wchar_t</span> <span class="pre">c</span> <span class="pre">=</span> <span class="pre">L'你';</span></code> ，变量 <code class="docutils literal"><span class="pre">c</span></code> 的值就是汉字“你”的31位Unicode码，而 <code class="docutils literal"><span class="pre">L&quot;你好\n&quot;</span></code> 就相当于数组 <code class="docutils literal"><span class="pre">wchar_t</span> <span class="pre">str[]</span> <span class="pre">=</span> <span class="pre">{</span> <span class="pre">L'你',</span> <span class="pre">L'好',</span> <span class="pre">L'\n',</span> <span class="pre">0</span> <span class="pre">};</span></code> 。C标准还定义了一些操作宽字符串的库函数，例如 <code class="docutils literal"><span class="pre">wcslen</span></code> 函数可以取宽字符串中的字符个数。</p>
<p>注意Wide Character和Multibyte Character这两个概念的区别：</p>
<ol class="arabic simple">
<li>C标准没有规定Wide Character和Multibyte Character应该采用什么编码，但目前各种Linux发行版的Wide Character都采用Unicode码，Multibyte Character都采用UTF-8编码。</li>
<li>每个Wide Character有固定的长度，用 <code class="docutils literal"><span class="pre">wchar_t</span></code> 类型来表示。而每个Multibyte Character的长度不固定，没有规定一种类型来表示Multibyte Character。</li>
<li>Wide Character中可能包含字节0，所以不能保存在普通的以Null结尾的字符串中，而必须保存在宽字符串中。而Multibyte Character中除了Null字符外不允许出现字节0，因此可以保存在以Null结尾的字符串中。</li>
<li>Wide Character适合做字符运算，比如统计字符数，而Multibyte Character适合做存储和传输，存储时比较节省空间，传输时有较好的容错性。</li>
</ol>
<p>看下面的例子：</p>
<div class="highlight-c"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;locale.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">setlocale</span><span class="p">(</span><span class="n">LC_CTYPE</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;Can&#39;t set the specified locale! &quot;</span>
                        <span class="s">&quot;Check LC_ALL, LC_CTYPE, LANG.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%ls&quot;</span><span class="p">,</span> <span class="s">L&quot;你好</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>宽字符串 <code class="docutils literal"><span class="pre">L&quot;你好\n&quot;</span></code> 在源代码中当然还是UTF-8编码，但编译器会把它转换成4个Unicode码 <code class="docutils literal"><span class="pre">0x00004f60</span> <span class="pre">0x0000597d</span> <span class="pre">0x0000000a</span> <span class="pre">0x00000000</span></code> 保存到目标文件中，按小端存储就是 <code class="docutils literal"><span class="pre">60</span> <span class="pre">4f</span> <span class="pre">00</span> <span class="pre">00</span> <span class="pre">7d</span> <span class="pre">59</span> <span class="pre">00</span> <span class="pre">00</span> <span class="pre">0a</span> <span class="pre">00</span> <span class="pre">00</span> <span class="pre">00</span> <span class="pre">00</span> <span class="pre">00</span> <span class="pre">00</span> <span class="pre">00</span></code> ，用 <code class="docutils literal"><span class="pre">hexdump</span></code> 命令查看目标文件可以找到这些字节。</p>
<p><code class="docutils literal"><span class="pre">printf</span></code> 的转换说明 <code class="docutils literal"><span class="pre">%ls</span></code> 表示把后面的参数按宽字符串解释，不是见到字节0就结束，而是见到Null字符的Unicode码（4个字节0）才结束，但输出到终端仍然要以Multibyte Character编码输出，这样终端设备才能识别，所以 <code class="docutils literal"><span class="pre">printf</span></code> 函数先把宽字符串转换成UTF-8编码的Multibyte Character字符串再输出到终端。我们把输出重定向到文件会看得更清楚:</p>
<div class="highlight-python"><div class="highlight"><pre>$ gcc main.c
$ ./a.out &gt; foo
$ hexdump -C foo
00000000  e4 bd a0 e5 a5 bd 0a                              |.......|
00000007
</pre></div>
</div>
<p>最后解释一下 <em class="manpage">setlocale(3)</em> 函数：</p>
<ol class="arabic simple">
<li>虽然当前系统的Locale设置是 <code class="docutils literal"><span class="pre">&quot;en_US.UTF-8&quot;</span></code> ，但C程序在启动时各种Locale参数都设置成默认值 <code class="docutils literal"><span class="pre">&quot;C&quot;</span></code> ，并不继承当前系统的Locale设置。这样规定是为了代码的可移植性，如果一个C程序不调用 <code class="docutils literal"><span class="pre">setlocale</span></code> 函数，那么它不管在什么系统上运行，其各种Locale参数都是 <code class="docutils literal"><span class="pre">&quot;C&quot;</span></code> ，其中 <code class="docutils literal"><span class="pre">LC_CTYPE</span></code> 参数是 <code class="docutils literal"><span class="pre">&quot;C&quot;</span></code> 表示采用ASCII字符集。</li>
<li>我们调用 <code class="docutils literal"><span class="pre">setlocale</span></code> 传的第一个参数是 <code class="docutils literal"><span class="pre">LC_CTYPE</span></code> ，它在C语言中被定义成一个整数常量，第二个参数是设置给它的值。如果第二个参数是空字符串 <code class="docutils literal"><span class="pre">&quot;&quot;</span></code> ，则表示采用当前系统的Locale设置， <code class="docutils literal"><span class="pre">setlocale</span></code> 函数依次查找环境变量 <code class="docutils literal"><span class="pre">LC_ALL</span></code> 、 <code class="docutils literal"><span class="pre">LC_CTYPE</span></code> 和 <code class="docutils literal"><span class="pre">LANG</span></code> ，找到第一个有定义的环境变量就用它的值来设置 <code class="docutils literal"><span class="pre">LC_CTYPE</span></code> 。因此，调用 <code class="docutils literal"><span class="pre">setlocale</span></code> 函数后 <code class="docutils literal"><span class="pre">LC_CTYPE</span></code> 参数的值变成了 <code class="docutils literal"><span class="pre">&quot;en_US.UTF-8&quot;</span></code> 。</li>
<li><code class="docutils literal"><span class="pre">LC_CTYPE</span></code> 参数影响C语言对宽字符和宽字符串的处理，正因为我们通过这个参数设置了UTF-8编码， <code class="docutils literal"><span class="pre">printf</span></code> 函数才会把宽字符串转换成UTF-8编码的Multibyte Character字符串再输出到终端。上面的程序如果去掉 <code class="docutils literal"><span class="pre">setlocale</span></code> 调用， <code class="docutils literal"><span class="pre">LC_CTYPE</span></code> 参数的值默认是 <code class="docutils literal"><span class="pre">&quot;C&quot;</span></code> （采用ASCII字符集），则无法打印出“你好”，因为这两个字符不属于ASCII字符集。</li>
</ol>
<p>关于Unicode和UTF-8本节只介绍了最基本的概念，部分内容出自 <a class="reference internal" href="bibli.html#unicodefaq" id="id2">[UnicodeFAQ]</a> ，读者可进一步参考这篇文章。</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">字符编码</a><ul>
<li><a class="reference internal" href="#ascii">ASCII码</a></li>
<li><a class="reference internal" href="#unicodeutf-8">Unicode和UTF-8</a></li>
<li><a class="reference internal" href="#linux-cunicodeutf-8">在Linux C编程中使用Unicode和UTF-8</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="linkedlist.html"
                        title="previous chapter">12. 链表、二叉树和哈希表</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="app-gfdl.html"
                        title="next chapter">GNU Free Documentation License Version 1.3, 3 November 2008</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/zh/app-encoding.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><table border=0 cellspacing=0 style="color: white;">
<script type="text/javascript">
  //<![CDATA[
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34437927-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  //]]>
</script>
<tr><td>
   请输入您的email订阅<a href="http://groups.google.com/group/learning-linux-c-cpp">本书的邮件列表</a><br/>
   (Please enter your email to subscribe to <a href="http://groups.google.com/group/learning-linux-c-cpp">this book's mailing list</a>)<br/>
   <form action="http://groups.google.com/group/learning-linux-c-cpp/boxsubscribe"><input type=text name=email><input type=submit name="sub" value="订阅(Subscribe)"></form>
</td></tr>

<tr><td><br/>关注<a href="http://weibo.com/sansoong">我的微博</a></td></tr>

<tr><td><br/>Checkout the source from github: <a href="https://github.com/learning-linux-c-cpp/akabook">https://github.com/learning-linux-c-cpp/akabook</a></td></tr>

<tr><td>
   <br/>感谢您的慷慨捐赠！<br/>
   Thanks for your generous donation!<br/>
   <a href="http://me.alipay.com/songjinshan" target="_blank"><img src="/akabook/_static/me.alipay.png" alt="捐赠"></a>
</td></tr>
</table>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="app-gfdl.html" title="GNU Free Documentation License Version 1.3, 3 November 2008"
             >next</a> |</li>
        <li class="right" >
          <a href="linkedlist.html" title="12. 链表、二叉树和哈希表"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">akabook 3.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >中文版：Linux C/C++编程一站式学习</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2012, Sean Soong.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>